
/*! Travel Planning Game 23-01-2014 */
"use strict";angular.module("travelPlanningGame.maps",["AngularGM","travelPlanningGame.templates"]),angular.module("travelPlanningGame.widgets",["AngularGM","travelPlanningGame.templates"]),angular.module("travelPlanningGame.app",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","angular-underscore","angular-rome2rio","travelPlanningGame.maps","travelPlanningGame.widgets","travelPlanningGame.templates"]).config(["$routeProvider","rome2rioProvider",function(a,b){a.when("/",{templateUrl:"views/game.html",controller:"GameCtrl"}),b.setKey("uuSKZSEU"),b.setServer("free.rome2rio.com"),b.setResponseFormat("json"),b.setAPIVersion("1.2"),b.setCurrency("AUD"),b.setDetailLevel("street_address")}]).run(["landmarks",function(a){a.get()}]),angular.module("travelPlanningGame.app").factory("landmarks",["$http","$q","resources",function(a,b,c){function d(){var c=b.defer();return g?c.resolve(g):a.get(f).success(function(a){g=a,angular.forEach(g,function(a){a.resources=e(a)}),c.resolve(g)}).error(function(){c.reject()}),c.promise}function e(a){var b=c.new();return b.subtract(c.categories.VISITING,c.types.MONEY,a.visitingCost),b.subtract(c.categories.LODGING,c.types.MONEY,a.lodgingCost),b.add(c.categories.VISITING,c.types.XP,a.visitingExp),b.add(c.categories.SHOPPING,c.types.SOUVENIR,a.souvenirs),b.subtract(c.categories.SHOPPING,c.types.MONEY,a.souvenirCost),b.add(c.categories.ONETIME,c.types.XP,a.exp),b}var f="landmarks.json",g=null;return{get:d}}]),angular.module("travelPlanningGame.maps").factory("mapGeocoder",["$q","angulargmUtils",function(a,b){if(angular.isUndefined(google))return{};var c=new google.maps.Geocoder,d={};return d.toCoords=function(d){var e=a.defer();return c.geocode({address:d},function(a){e.resolve(b.latLngToObj(a[0].geometry.location))}),e.promise},d.toAddress=function(b){var d=a.defer();return c.geocode({latLng:b},function(a){d.resolve(a[0].formatted_address)}),d.promise},d}]),angular.module("travelPlanningGame.maps").factory("mapStyles",function(){var a={};return a.shiftWorker=[{stylers:[{saturation:-100},{gamma:1}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"on"},{saturation:50},{gamma:0},{hue:"#50a5d1"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{weight:.5},{color:"#333333"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{gamma:1},{saturation:50}]}],a.routeXL=[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{saturation:-100},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{visibility:"on"},{saturation:-100},{lightness:40}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{saturation:-10},{lightness:30}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"simplified"},{saturation:-60},{lightness:10}]},{featureType:"landscape.natural",elementType:"all",stylers:[{visibility:"simplified"},{saturation:-60},{lightness:60}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"},{saturation:-100},{lightness:60}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"},{saturation:-100},{lightness:60}]}],a.paleDawn=[{featureType:"water",stylers:[{visibility:"on"},{color:"#acbcc9"}]},{featureType:"landscape",stylers:[{color:"#f2e5d4"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#c5c6c6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#e4d7c6"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#fbfaf7"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#c5dac6"}]},{featureType:"administrative",stylers:[{visibility:"on"},{lightness:33}]},{featureType:"road"},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"},{lightness:20}]},{},{featureType:"road",stylers:[{lightness:20}]}],a.oldTimey=[{featureType:"administrative",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"simplified"}]},{featureType:"road",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"simplified"}]},{featureType:"transit",stylers:[{visibility:"simplified"}]},{featureType:"landscape",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{visibility:"off"}]},{featureType:"road.local",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"water",stylers:[{color:"#84afa3"},{lightness:52}]},{stylers:[{saturation:-77}]},{featureType:"road"}],a.midnight=[{featureType:"water",stylers:[{color:"#021019"}]},{featureType:"landscape",stylers:[{color:"#08304b"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#0c4152"},{lightness:5}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#0b434f"},{lightness:25}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#000000"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#0b3d51"},{lightness:16}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.stroke",stylers:[{color:"#000000"},{lightness:13}]},{featureType:"transit",stylers:[{color:"#146474"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#144b53"},{lightness:14},{weight:1.4}]}],a}),angular.module("travelPlanningGame.app").factory("resources",function(){function a(){return new g}function b(a,b,c,d){var f=!0;return angular.forEach(c[d],function(c,d){e[d]&&!e[d](a[b][d],c)&&(f=!1)}),f}function c(a,c,d,e){b&&angular.forEach(d[e],function(b,d){a.update(c,d,b)})}var d={};d.ALL=10,d.MONEY=11,d.XP=12,d.SOUVENIR=13;var e={};e.MONEY=function(a,b){return a+b>=0},e.XP=function(a,b){return a+b>=0},e.SOUVENIR=function(a,b){return a+b>=0};var f={};f.ALL=99,f.VISITING=98,f.LODGING=97,f.SHOPPING=96,f.DISCOVERY=95;var g=function(){this.get=function(a,b){return this[a]&&this[a][b]?this[a][b]:0},this.update=function(a,b,c){return this[a]||(this[a]={}),this[a][b]||(this[a][b]=0),(!e[b]||e[b](this[a][b],c))&&(this[a][b]+=c),this},this.add=this.update,this.subtract=function(a,b,c){return this.update(a,b,-1*c)}};return{"new":a,canDelta:b,delta:c,types:d,categories:f}}),angular.module("travelPlanningGame.app").factory("timer",function(){function a(a){return l[a]?l[a]:null}function b(a,b){m.days=a>=1?a:1,m.times=b>=1?b<=l.length?b:l.length:1}function c(){return m}function d(){return n}function e(a){return a||(a=n),a.day+"."+a.time}function f(a){var b=a.split(".");return new o(b[0],b[1])}function g(){return n=new o(1,1),!0}function h(){if(k())return!1;var a=i()?n.day+1:n.day,b=i()?1:n.time+1;return n=new o(a,b),!0}function i(){return n.time===m.times}function j(){return n.day===m.days}function k(){return j()&&i()}var l=["morning","afternoon","evening","night"],m={};m.days=1,m.times=1;var n=null,o=function(a,b){this.day=a,this.time=b};return{config:b,getLimits:c,start:g,next:h,isLast:k,isEOD:i,now:d,toTimestamp:e,fromTimestamp:f,toTimeOfDay:a}}),angular.module("travelPlanningGame.app").directive("landmarkCard",function(){return{restrict:"EA",transclude:!0,scope:{landmark:"="},templateUrl:"templates/landmark-card.tpl.html"}}),angular.module("travelPlanningGame.maps").directive("gameMap",function(){return{templateUrl:"templates/maps.game.tpl.html",restrict:"EA",scope:{focalPoint:"=",ngModel:"=",availableLocations:"="},link:function(a,b){a.isEnabled=function(){return!b.attr("disabled")},a.showTransit=angular.isDefined(b.attr("show-transit"))&&"false"!==String(b.attr("show-transit")).toLowerCase()},controller:["$scope","$q","$filter","angulargmContainer","angulargmUtils","mapGeocoder","mapStyles","rome2rio",function(a,b,c,d,e,f,g,h){angular.isUndefined(google)||(a.map={},a.map.zoom=12,a.map.type="roadmap",a.map.bounds=new google.maps.LatLngBounds,a.map.styles=g.routeXL,a.currentLocation=null,a.selectLocation=function(b,c){a.currentLocation||f.toCoords("Singapore").then(function(b){a.currentLocation={},a.currentLocation.coords=angular.copy(b)}),a.ngModel=b,a.focalPoint=b,a.currentLocation&&h.search(a.currentLocation.name,b.name,h.toPosition(a.currentLocation.coords.lat,a.currentLocation.coords.lng),h.toPosition(b.coords.lat,b.coords.lng)).then(function(a){angular.forEach(a.getPaths(),function(a){new google.maps.Polyline({strokeColor:"#3ABA3A",strokeOpacity:1,strokeWeight:5,map:c.getMap(),path:google.maps.geometry.encoding.decodePath(a)})})})},a.$watch("ngModel",function(b,c){!b&&c&&(a.currentLocation=c),a.$broadcast("gmMarkersUpdate")}),d.getMapPromise("gameMap").then(function(b){if(b.mapTypeId=a.map.type,b.zoom=a.map.zoom,b.setOptions({styles:a.map.styles,panControl:!1,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,overviewMapControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_CENTER}}),a.showTransit){var c=new google.maps.TransitLayer;c.setMap(b)}angular.forEach(a.availableLocations,function(c,d){c.id=d,f.toCoords(c.address).then(function(f){c.coords=angular.copy(f),a.map.bounds.extend(e.objToLatLng(f)),d===a.availableLocations.length-1&&(b.fitBounds(a.map.bounds),a.$broadcast("gmMarkersUpdate")),a.showLabel(c,null,b)})}),a.$watch("focalPoint",function(a){a&&a.coords&&b.panTo(e.objToLatLng(a.coords))})}),a.infoWindows={},a.showLabel=function(b,c,d){if(!c&&!d)return!1;var f;if(a.infoWindows[b.id])f=a.infoWindows[b.id];else{var g={};g.content='<span style="font-weight: 700">'+b.name+"</span>",g.position=e.objToLatLng(b.coords),g.pixelOffset=new google.maps.Size(0,-15),f=new google.maps.InfoWindow(g),a.infoWindows[b.id]=f}return d||(d=c.getMap()),f.open(d),!0},a.getMarkerOptions=function(b){var c={};a.ngModel&&b.id===a.ngModel.id?(c.url="../../images/marker-orange.png",c.size=new google.maps.Size(66,66),c.origin=new google.maps.Point(0,0),c.anchor=new google.maps.Point(33,33)):(c.url="../../images/marker-grey.png",c.size=new google.maps.Size(30,30),c.origin=new google.maps.Point(0,0),c.anchor=new google.maps.Point(15,15));var d={title:"Click to select "+b.name,icon:c};return d})}]}}),angular.module("travelPlanningGame.widgets").directive("widgetResourceIndicator",function(){return{restrict:"EA",templateUrl:"templates/widgets.resource-indicator.tpl.html",scope:{resources:"=",type:"@",category:"@"},link:function(a){a.icon="MONEY"===a.type?"dollar":"XP"===a.type?"star":"shopping-cart"},controller:["$scope","$filter","resources",function(a,b,c){a.getValue=function(){return b("number")(a.resources.get(c.categories[a.category],c.types[a.type]))}}]}}).directive("widgetDayCounter",function(){return{restrict:"EA",templateUrl:"templates/widgets.day-counter.tpl.html",scope:{day:"="},controller:["$scope","timer",function(a,b){a.$watch("day",function(){a.now=b.now(),a.limits=b.getLimits()})}]}}),angular.module("travelPlanningGame.app").controller("BootCtrl",["$scope",function(a){a.isReady=function(){return angular.isDefined(google)}}]),angular.module("travelPlanningGame.app").controller("GameCtrl",["$scope","timer","landmarks","resources",function(a,b,c,d){a.current={};var e=["menu","playing","stats"];a.current.state=e[0],a.game={},a.game.start=function(){a.current.state="playing";var c=d.new();c.add(d.categories.ALL,d.types.MONEY,a.settings.budget),a.resources=c,b.config(a.settings.travelDays,3),b.start()},a.game.end=function(){a.current.state="stats"},a.game.menu=function(){a.current.state="menu"},a.getDay=function(){return b.now().day},a.game.canPlay=function(c){return a.locations.selected?a.settings.sandboxMode?c?null:!0:d.canDelta(a.resources,d.categories.ALL,a.locations.selected.resources,d.categories.VISITING)?b.isEOD()&&!d.canDelta(a.resources,d.categories.ALL,a.locations.selected.resources,d.categories.LODGING)?c?"Not enough funds for lodging around here.":!1:c?null:!0:c?"Not enough funds for visiting this landmark.":!1:c?"Select a landmark to visit.":!1},a.game.startTurn=function(){a.current.location=a.locations.selected,d.delta(a.resources,d.categories.ALL,a.current.location.resources,d.categories.VISITING),a.isInTurn=!0},a.game.canShop=function(b){return d.canDelta(a.resources,d.categories.ALL,a.current.location.resources,d.categories.SHOPPING)?b?null:!0:b?"Not enough funds for shopping today.":!1},a.game.shop=function(){d.delta(a.resources,d.categories.ALL,a.current.location.resources,d.categories.SHOPPING)},a.game.endTurn=function(){b.isEOD()&&d.delta(a.resources,d.categories.ALL,a.current.location.resources,d.categories.LODGING),b.isLast()&&a.game.end(),b.next(),a.isInTurn=!1,a.locations.selected=null},a.whyCantI=function(a){return a(!0)},a.locations={},a.locations.cities=["Singapore"],a.locations.landmarks=null,c.get().then(function(b){a.locations.landmarks=b}),a.locations.selected=null,a.current.location=null,a.current.city=a.locations.cities[0],a.settings={},a.settings.budget=1e3,a.settings.travelDays=4}]),angular.module("travelPlanningGame.templates",["templates/landmark-card.tpl.html","templates/maps.game.tpl.html","templates/widgets.day-counter.tpl.html","templates/widgets.resource-indicator.tpl.html"]),angular.module("templates/landmark-card.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/landmark-card.tpl.html",'<!-- Landmark card -->\n<div class="landmark-card" ng-class="{flipped : isFlipped}">\n\n	<!-- Front face -->\n	<div class="panel panel-primary landmark-card-face landmark-card-face-front">\n\n		<!-- Landmark name and controls -->\n		<div class="panel-header panel-heading">\n\n			<!-- Controls -->\n			<i class="fa close fa-times fa-fw" ng-click="landmark = null"></i>\n			<i class="fa close fa-rotate-left fa-fw" ng-click="isFlipped = !isFlipped"></i>\n\n			<h3>{{ landmark.name }}</h3>\n		</div>\n		<!-- end name and controls -->\n\n		<!-- Image and quick stats -->\n		<div class="panel-body" ng-style="{\'background-image\': \'url(\' + landmark.image + \')\'}">\n			<div class="col-xs-offset-9">\n				<div class="thumbnail resource text-center">\n					<small>LODGING</small>\n					<h3>{{ landmark.lodgingCost }} <i class="fa fa-dollar"></i>\n					</h3>\n					<small>PER DAY</small>\n				</div>\n				<div class="thumbnail resource text-center">\n					<small>VISITING</small>\n					<h3>{{ landmark.visitingCost }} <i class="fa fa-dollar"></i>\n					</h3>\n					+{{ landmark.visitingExp }} <i class="fa fa-star"></i>\n				</div>\n				<div class="thumbnail resource text-center">\n					<h3>{{ landmark.souvenirs }} <i class="fa fa-shopping-cart"></i>\n					</h3>\n					<small>FOR {{ landmark.souvenirCost }} <i class="fa fa-dollar"></i>\n					</small>\n				</div>\n			</div>\n		</div>\n		<!-- end image and stats -->\n\n		<!-- Features, flavour text and options -->\n		<ul class="list-group">\n			<li class="list-group-item list-item" ng-repeat="bonus in landmark.bonuses">\n				<span class="pull-right text-primary" ng-show="bonus.type">{{ bonus.type | uppercase }}</span>\n				<i class="fa" ng-class="bonus.icon"></i> {{ bonus.flavour }}\n				<em class="text-muted" ng-show="bonus.implication">\n					<small>({{ bonus.implication }})</small>\n				</em>\n			</li>\n		</ul>\n		<!-- end features -->\n\n		<!-- One time bonus -->\n		<div class="panel-footer text-center">\n			One-time visiting bonus:\n			<strong>+{{ landmark.exp }} <i class="fa fa-star"></i>\n			</strong>\n		</div>\n		<!-- end bonus -->\n\n	</div>\n	<!-- end front face -->\n\n	<!-- Back face -->\n	<div class="panel panel-primary landmark-card-face landmark-card-face-back">\n\n		<!-- Landmark name and controls -->\n		<div class="panel-header panel-heading">\n\n			<!-- Controls -->\n			<i class="fa close fa-times fa-fw" ng-click="landmark = null"></i>\n			<i class="fa close fa-rotate-left fa-fw" ng-click="isFlipped = !isFlipped"></i>\n\n			<h3>{{ landmark.name }}</h3>\n		</div>\n		<!-- end name and controls -->\n\n		<!-- Image -->\n		<div class="panel-body" ng-style="{\'background-image\': \'url(\' + landmark.image + \')\'}">\n			<div class="col-xs-offset-9 invisible">\n				<div class="thumbnail resource text-center">\n					<small>LODGING</small>\n					<h3>{{ landmark.lodgingCost }} <i class="fa fa-dollar"></i>\n					</h3>\n					<small>PER DAY</small>\n				</div>\n				<div class="thumbnail resource text-center">\n					<small>VISITING</small>\n					<h3>{{ landmark.visitingCost }} <i class="fa fa-dollar"></i>\n					</h3>\n					+{{ landmark.visitingExp }} <i class="fa fa-star"></i>\n				</div>\n				<div class="thumbnail resource text-center">\n					<h3>{{ landmark.souvenirs }} <i class="fa fa-shopping-cart"></i>\n					</h3>\n					<small>FOR {{ landmark.souvenirCost }} <i class="fa fa-dollar"></i>\n					</small>\n				</div>\n			</div>\n		</div>\n		<!-- end image -->\n\n		<!-- Features, flavour text and options -->\n		<ul class="list-group">\n			<li class="list-group-item list-item">{{ landmark.description }}</li>\n		</ul>\n		<!-- end features -->\n\n		<!-- One time bonus -->\n		<div class="panel-footer text-center">\n			<div class="invisible">\n				One-time visiting bonus:\n				<strong>+{{ landmark.exp }} <i class="fa fa-star"></i>\n				</strong>\n			</div>\n		</div>\n		<!-- end bonus -->\n\n	</div>\n	<!-- end back face -->\n\n</div>\n<!-- end card -->\n')}]),angular.module("templates/maps.game.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/maps.game.tpl.html",'<div gm-map\n	ng-if="isEnabled()"\n	class="map-canvas"\n	gm-map-id="\'gameMap\'"\n	gm-center="center"\n	gm-zoom="zoom"\n	gm-bounds="bounds"\n	gm-map-type-id="type">\n	<div gm-markers\n		gm-objects="availableLocations"\n		gm-id="object.id"\n		gm-marker-options="getMarkerOptions(object)"\n		gm-position="{lat: object.coords.lat, lng: object.coords.lng}"\n		gm-on-click="selectLocation(object, marker); showLabel(object, marker)">\n	</div>\n	<div id="map-infoWindow-markerLabel-sample">\n		<div class="well">\n			<strong>{{ location.name }}</strong>\n		</div>\n	</div>\n</div>')}]),angular.module("templates/widgets.day-counter.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/widgets.day-counter.tpl.html",'<div class="widget-day-counter">\n	<h1>Day</h1>\n	<h1>{{ now.day | number }}<small>/ {{ limits.days }}</h1>\n</div>\n')}]),angular.module("templates/widgets.resource-indicator.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/widgets.resource-indicator.tpl.html",'<div class="widget-resource-indicator" ng-class="\'widget-resource-indicator-\' + type">\n	<i class="widget-resource-indicator-icon fa fa-fw fa-3x" ng-class="\'fa-\' + icon"></i>\n	<span class="widget-resource-indicator-value" ng-bind="getValue()"></span>\n</div>\n')}]);